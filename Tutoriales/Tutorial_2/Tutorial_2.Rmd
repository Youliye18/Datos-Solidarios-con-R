---
title: 'Datos Solidarios con R: Procesando datos'
subtitle: 'An√°lisis y visualizaci√≥n de datos para el sector solidario en Colombia'
output:
  pdf_document:
    toc: false
    number_sections: false
    latex_engine: xelatex
  word_document:
    toc: false
  html_document:
    theme: flatly
    toc: false
    df_print: paged
    number_sections: false
    self_contained: true
fontsize: 13pt
geometry: margin=1in
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

### üóÉÔ∏èÔ∏è Abriendo una base datos

En el nivel m√°s simple, se puede pensar en una base de datos como una colecci√≥n de *data frames*. Al igual que un *data frame*, una base de datos es una colecci√≥n de columnas con nombre, donde cada valor de la columna es del mismo tipo.

R se puede conectar a muchas bases de datos relacionales, como Oracle, MySQL, SQL Server, etc., y obtiene el resultado como un *data frame*. Una vez que el conjunto de resultados se obtiene en un marco de datos, resulta muy f√°cil visualizarlos y manipularlos. 

**Para este tutorial usaremos un banco de datos simulados, es decir con informaciones ficticias, sobre empresas solidarias en Colombia.** Aunque las informaciones son ficticias, las categor√≠as (variables) son muy semejantes a las que usamos en la entidad. 

```{r}
#install.packages("readxl")
library("readxl")

datos <- readxl::read_excel("Datos/Datos_Solidarios_2025.xlsx")
#View(datos)
```

Una vez cargamos el banco de datos, lo primero que debemos hacer es revisarlo y ver las informaciones contenidas all√≠ esten correctas para poder realizar el an√°lisis posterior. 

```{r}
datos
```

Para este tutorial de *manipulaci√≥n*, limpieza y visualizaci√≥n de datos usaremos la librer√≠a de tidyverse porque:

(i) es m√°s f√°cil de aprender

(ii) es m√°s sistem√°tico 

(iii) es m√°s transparente de leer y comprender que otros enfoques. 

Manipular datos en R es similar a preparar una receta. Debemos seleccionar, cortar, combinar y transformar los ingredientes para obtener un buen resultado. De esta manera, siempre comenzamos con nuestros datos brutos (data.frame) y, en la l√≥gica de tidyverse, aplicamos ('verbos') que transforman nuestra base de datos. 

Es importante resaltar que, esta l√≥gica de manipulaci√≥n de datos basada en 'verbos' es solo un enfoque en el flexible mundo de R. Existen diversas formas de llegar al mismo resultado o a resultados parecidos, **esa es la magia de R**. ü™Ñ

```{r}
#library(tidyverse)

datos %>% summary()
```

Si tenemos dudas sobre el tipo de variables del banco que estamos usando, podemos usar el siguiente c√≥digo: 

```{r}
class(datos$zomac)
```

### ‚úçüèæRenombrar variables (*rename*)

Muchas veces vamos a trabajar con datos cuyos nombres de las variables no son intuitivos o no est√°n estandarizados. Por lo cual, una de las transformaciones m√°s simples, pero a la vez importantes, es cambiarle el nombre de las variables.  

Pero antes necesitamos saber, **¬øqu√© son variables?** 

Las variables son contenedores para almacenar valores de datos, las cuales usualmente se encuentran organizados de forma vertical (*Columnas*). Para los fines de este tutorial, **entenderemos las informaciones agrupadas en las columnas como variables**; mientras que, **los datos que se ubican en las filas (horizontalmente) ser√°n observaciones**. 

Una funci√≥n que podemos usar para saber los nombres de las variables de nuestro banco es: `names()`, como se muestra a continuaci√≥n: 

```{r}
names(datos)
```

Para este ejemplo vamos a renombrar las variables `nom_dpto` y `nom_mpio` y atribuir nombres m√°s intuitivos como departamento y municipio, respectivamente. 

La estructura b√°sica para usar las funciones de `tidyverse` es: iniciar con el objecto (en este caso la base de datos) luego conectamos la funci√≥n a ser usada con el simbolo llamado *pipe* (>%>) y seguimos las orientaciones de cada funci√≥n. Si no sabemos c√≥mo usar una funci√≥n, siempre podremos consultar su documentaci√≥n y aprender a usarla. 

En el caso de la funci√≥n *rename*, dentro de los par√©ntesis () debemos colocar el nombre nuevo primero y luego el nombre antiguo. Como se muestra en el ejemplo siguiente:  

```{r}
datos %>% rename(departamento = nom_dpto)
```



### ‚úÇÔ∏è Seleccionar/ Cortar Observaciones (*slice*)

La primera manipulaci√≥n la realizamos a una variable (columna). No obstante, tambi√©n podemos manipular observaciones (lineas). Por ejemplo, podemos limitar nuestro an√°lisis a las primeras 100 observaciones (l√≠neas), usando el verbo slice().


```{r}
datos %>% slice(1:100)
```

Sim embargo, los c√≥digos anteriores no modifican la base de datos a menos que as√≠ lo establezcamos. Para eso debemos rescribir el objecto que contiene la base de datos, como se muestra a continuaci√≥n: 


```{r}
datos <- datos %>% slice(1:100)
```



### üí± Seleccionar variables (*select*)

Ya aprendimos la estructura b√°sica para usar funciones, y todo lo que aprenderemos a partir de ahora sigue el mismo patr√≥n. Cuando tenemos demasiadas columnas en nuestra base de datos, siempre es √∫til centrarse en las variables m√°s relevantes, excluyendo las que no se utilizar√°n. Para seleccionar un subconjunto de las variables (columnas) para mantener en el tibble, usamos el verbo select(). De nuevo, comenzamos con el dataframe, el *pipe* y, finalmente, el verbo select. 

En el siguiente ejemplo, vamos a seleccionar 5 de las 15 variables que tenemos en el banco original a seguir: el c√≥digo de la entidad, nombre de la entidad, Activos, Ingresos y Pasivos. 

```{r}
datos %>% select(cod_Entidad, nombreentidad, Activos, Ingresos, Pasivos)
```


### üî° Agrupar observaciones (group_by)

Usualmente nuestros datos est√°n organizados en categor√≠as o subcategor√≠as. Por ejemplo, por a√±o, por departamentos, o tipo de entidad. Adem√°s, muy a menudo necesitamos generar nuevas informaciones, por medio de tablas o gr√°ficos, basadas en estas categor√≠as. 

De este modo, podemos usar la funci√≥n `group_by ()` para crear m√∫ltiples niveles/tipos de agrupaciones. Esta  es principalmente una funci√≥n complementar, que optimiza la eficacia de otras funciones para realizar c√°lculos como: `summarize()` o `tally ()`. 

En el siguiente ejemplo se usa  `group_by ()` acompa√±ado de la funci√≥n `tally ()`, la cual es √∫til para contar el n√∫mero de observaciones por grupo. 


```{r}
datos %>% group_by(tipo) %>%
  tally()
```


### üìà Estad√≠sticas Resumidas (summarize)

La funci√≥n `summarize()` se usa para sintetizar informaciones provenientes de c√°lculos estad√≠sticos, a partir de su combinaci√≥n con funciones estad√≠sticas b√°sicas de R como las que se muestran a continuaci√≥n:

|       Estad√≠stica       |           Funci√≥n en R          |
|:-----------------------:|:-------------------------------:|
|        **Media**        |         _mean(variable)_        |
|       **Mediana**       |        _median(variable)_       |
| **Desviaci√≥n Est√°ndar** |          _sd(variable)_         |
|    **Cuantil (10%)**    | _quantile(variable, probs=0.1)_ |
|        **M√°ximo**       |         _max(variable)_         |
|        **M√≠nimo**       |         _min(variable)_         |



As√≠, esta funci√≥n genera un nuevo tibble peque√±o (table/data.frame) para contener las estad√≠sticas de resumen, abandonando nuestro tibble original. La funci√≥n requiere tres elementos: 

(i) el nombre de la nueva variable en el nuevo tibble; 

(ii) la funci√≥n que agregar√°/resumir√° la variable; y 

(iii) la variable que se resumir√°.


En el ejemplo siguiente, usaremos las funciones `group_by ()` y `summarize()` para calcular la media de Activos de los tres tipos de empresas solidarias contenidas en la base de datos de este tutorial.


```{r}
datos %>% group_by(tipo) %>% 
  summarize(media_activos = mean(Activos))
```

### üìä Gr√°ficos

Terminaremos este tutorial con un peque√±o *abre bocas* de c√≥mo podemos generar gr√°ficos en R usando uno de los paquetes de `tidyverse` llamado `ggplot2`. 


La estructura (sintaxis) de `ggplot`es nueva y diferente, pero se integra a la perfecci√≥n en nuestro flujo de trabajo, siguiendo un proceso de preparaci√≥n de datos tras otra tuber√≠a (*pipe* %>%). La conexi√≥n con el elemento gr√°fico se realiza con el signo m√°s (+). 


A continuaci√≥n, realizaremos el *plot* de la tabla generada en la secci√≥n anterior transform√°ndola en un gr√°fico de barras con el siguiente c√≥digo:  


```{r}
datos %>% group_by(tipo) %>% 
  summarize(media_activos = mean(Activos)) %>%
  ggplot() +
  geom_col(aes(x=tipo, y = media_activos))
```

La primera parte del c√≥digo es exactamente igual a la que hab√≠amos utilizado en la secci√≥n anterior, el cambio viene a partir del uso de la funci√≥n `ggplot2` donde debemos agregar la geometr√≠a (*geom*) y la est√©tica (*aes*) **adecuada** y **deseada**. 

`ggplot2` nos permite personalizar los gr√°ficos de distintas maneras para obtener resultados m√°s llamativos y cautivantes dependiendo de nuestras necesidades.


```{r}
datos %>% group_by(tipo) %>% 
  summarize(media_activos = mean(Activos)) %>%
  ggplot() +
  geom_col(aes(x=tipo, y = media_activos), fill= "#a8ddb5") +
  ggtitle("Media de Activos de las empresas solidarias") +
  xlab("Tipo de Empresas Solidarias") +
  ylab("Media de Activos") +
  theme_bw()
```


En el c√≥digo anterior agregamos otras camadas de informaciones a saber: 

- **fill** se usa dentro de *aes()* para agregar un color fijo a los gr√°ficos

- **ggtitle** sirve para adicionar t√≠tulos a los gr√°ficos

- **xlab** sirve para modificar el nombre de la variable del eje X en el gr√°fico

- **ylab** sirve para modificar el nombre de la variable del eje Y en el gr√°fico

- **theme_** se usa para aplicar un tema (layout) al gr√°fico, en este caso estamos usando un tema llamado "bw"


### üë£ Pr√≥ximos pasos

Para los participantes que est√©n interesados en continuar con el aprendizaje de este lenguaje, se recomienda las siguientes opciones:

- Consultar manuales de programaci√≥n en R disponibles en la web como, por ejemplo: [Introducci√≥n a R para Ciencias](https://irwingss.github.io/intro_r_ciencias/)
- Explorar material disponible en p√°ginas como Youtube
- Estar atentos a las redes de Rladies en Colombia, pues se publican cursos online o webinars gratuitos. 
- Realizar cursos de an√°lisis de datos en R


---

#### üìú Licencia

Material educativo dise√±ado para el curso **Datos Solidarios con R**.  
¬© 2025 ‚Äî Yulieth Mart√≠nez Villalba



